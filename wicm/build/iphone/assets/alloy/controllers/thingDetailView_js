function Controller(){function e(e){var t={};t.image=e.source.image;var i=Alloy.createController("imagefullview",t),o=i.getView();o.open({modal:!0,modalTransitionStyle:Ti.UI.iPhone.MODAL_TRANSITION_STYLE_FLIP_HORIZONTAL,modalStyle:Ti.UI.iPhone.MODAL_PRESENTATION_FULLSCREEN,navBarHidden:!0})}function t(){Ti.API.info("going back now"),Alloy.Globals.navgroup.close(s.tdv,{animated:!0})}function i(){Ti.Gesture.removeEventListener("orientationchange",o),s.destroy()}function o(){var e;e=Ti.Platform.displayCaps.platformHeight,Ti.Gesture.orientation==Ti.UI.LANDSCAPE_LEFT||Ti.Gesture.orientation==Ti.UI.LANDSCAPE_RIGHT?(s.addClass(s.scrollView,"landscape"),Ti.API.info("openieng in landscape mode "+e),s.thing.height=e-20-44-40,s.thing.width="50%",s.detail.width="50%",s.commentScroller.height=e-20-44-18-20-18-40-40):(s.removeClass(s.scrollView,"landscape"),Ti.API.info("openieng in portrait mode "+e),s.thing.height=200,s.thing.width="100%",s.detail.width="100%",Ti.API.info("$.thing.height"+s.thing.size.height),s.commentScroller.height=e-200-20-44-18-20-18-40-40)}function l(){var e=w.thing.id;if(e){Alloy.Globals.loading.show("Loading Comments, Please wait..",!0);var t=Ti.Network.createHTTPClient();t.open("GET",Alloy.Globals.serverPath+"/api/things/"+e+"/comments"),t.send(),t.onload=function(){var e=JSON.parse(this.responseText);e=e.result;var t=[];if(0==e.length){var i=Alloy.createController("commentRow").getView();t.push(i)}else for(g=0;e.length>g;g++){var o={};o.comment=e[g].comment,e[g].user?(o.username=e[g].user.name,o.image=e[g].user.avatar):o.username="UNKNOWN";var i=Alloy.createController("commentRow",o).getView();t.push(i)}s.commentScroller.setData(t),Alloy.Globals.loading.hide()},t.onerror=function(){Ti.API.info("got some error"),Alloy.Globals.loading.hide()}}}function a(){if(Alloy.Globals.APIKey){Alloy.Globals.loading.show("Posting your comment, Please wait..",!0);var e=w.thing.id,t="comment="+s.commentField.value,i=Ti.Network.createHTTPClient();Ti.API.info("Token token="+Alloy.Globals.APIKey),i.open("POST","http://limitless-eyrie-1080.herokuapp.com/api/things/"+e+"/comments"),i.setRequestHeader("Authorization","Token token="+Alloy.Globals.APIKey),i.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),Ti.API.info("url--http://limitless-eyrie-1080.herokuapp.com/api/things/"+e+"/comments"),Ti.API.info("token--Token token="+Alloy.Globals.APIKey),i.onload=function(){l(),s.commentField.value=""},i.onerror=function(e){Alloy.Globals.loading.hide(),Ti.API.info("error--"+JSON.stringify(e)),Ti.API.info("error--"+JSON.stringify(this)),0==this.status?alert("Network not avaiable, please try again later"):2==this.status?alert("The request timed out, please try again later"):(500==this.status||404==this.status)&&alert("The request timed out, please try again later")},i.send(t)}else Alloy.Globals.loginFirst(a)}function r(){if(Alloy.Globals.APIKey){Alloy.Globals.loading.show("Making this thing as your favourite, Please wait..",!0);var e=w.thing.id,t=Ti.Network.createHTTPClient();Ti.API.info("Token token="+Alloy.Globals.APIKey),t.open("PUT",Alloy.Globals.serverPath+"/api/users/current/favorites/"+e),t.setRequestHeader("Authorization","Token token="+Alloy.Globals.APIKey),t.onload=function(){Alloy.Globals.loading.hide()},t.onerror=function(e){Alloy.Globals.loading.hide(),alert("Got some error"),Ti.API.info("error--"+JSON.stringify(e)),Ti.API.info("error--"+JSON.stringify(this))},t.send()}else Alloy.Globals.loginFirst(r)}function n(){var e=w.thing.id;if(e){var t={};t.popUpLabel="Confirm as inappropriate?",t.but1Label="Confirm",t.but2label="Cancel",t.but1handler=function(){Alloy.Globals.loading.show("Flagging now, Please wait..",!0),Alloy.Globals.removeCurrentMatch();var t=Ti.Network.createHTTPClient();t.open("POST",Alloy.Globals.serverPath+"/api/things/"+e+"/flag"),t.send(),t.onload=function(){Alloy.Globals.loading.hide(),i.close(),s.tdv.close(),Alloy.Globals.fetchNextMatch()},t.onerror=function(){Alloy.Globals.loading.hide(),i.close()}},t.but2handler=function(){i.close()};var i=Alloy.createController("popUpWindow",t).getView();i.open()}}require("alloy/controllers/BaseController").apply(this,Array.prototype.slice.call(arguments)),this.__controllerPath="thingDetailView",arguments[0]?arguments[0].__parentSymbol:null,arguments[0]?arguments[0].$model:null,arguments[0]?arguments[0].__itemTemplate:null;var s=this,d={},c={};s.__views.tdv=Ti.UI.createWindow({id:"tdv",backgroundColor:"#F5F5F5",modal:"true",navBarHidden:"true"}),s.__views.tdv&&s.addTopLevelView(s.__views.tdv),i?s.__views.tdv.addEventListener("close",i):c["$.__views.tdv!close!onClose"]=!0,s.__views.navview=Ti.UI.createView({top:"0",left:"0",height:"44",backgroundColor:"#E9E9E9",zIndex:"5",id:"navview"}),s.__views.tdv.add(s.__views.navview),s.__views.leftButton=Ti.UI.createButton({backgroundImage:"/images/btn_back.png",left:"10",top:"15",width:"30",height:"14",zIndex:"10",id:"leftButton"}),s.__views.navview.add(s.__views.leftButton),t?s.__views.leftButton.addEventListener("click",t):c["$.__views.leftButton!click!goBack"]=!0,s.__views.viewHeaderLabel=Ti.UI.createLabel({left:"10%",right:"10%",top:"0",height:"44",color:"#808080",textAlign:"center",font:{fontSize:"20",fontWeight:"bold"},text:"Thing Detail",id:"viewHeaderLabel"}),s.__views.navview.add(s.__views.viewHeaderLabel),s.__views.scrollView=Ti.UI.createScrollView({width:Ti.UI.FILL,layout:"vertical",bottom:40,top:44,apiName:"Ti.UI.ScrollView",classes:["portrait"],id:"scrollView",horizontalWrap:"false"}),s.__views.tdv.add(s.__views.scrollView),s.__views.thing=Ti.UI.createView({backgroundColor:"#fff",apiName:"Ti.UI.View",id:"thing",top:"0",classes:[]}),s.__views.scrollView.add(s.__views.thing),s.__views.thingImage=Ti.UI.createImageView({top:0,id:"thingImage"}),s.__views.thing.add(s.__views.thingImage),e?s.__views.thingImage.addEventListener("dblclick",e):c["$.__views.thingImage!dblclick!showFullImage"]=!0,s.__views.__alloyId100=Ti.UI.createView({width:Ti.UI.FILL,bottom:0,left:0,right:0,height:50,backgroundColor:"#5000",backgroundImage:null,opacity:1,id:"__alloyId100"}),s.__views.thing.add(s.__views.__alloyId100),s.__views.thingDetailsLabel=Ti.UI.createLabel({width:Ti.UI.FILL,top:5,bottom:5,left:5,right:5,color:"#fff",font:{fontSize:"14"},horizontalWrap:!0,id:"thingDetailsLabel"}),s.__views.__alloyId100.add(s.__views.thingDetailsLabel),s.__views.detail=Ti.UI.createView({height:Ti.UI.SIZE,width:Ti.UI.FILL,layout:"vertical",apiName:"Ti.UI.View",classes:["pt_detail"],id:"detail"}),s.__views.scrollView.add(s.__views.detail),s.__views.__alloyId101=Ti.UI.createView({height:"18",width:Ti.UI.FILL,layout:"horizontal",id:"__alloyId101"}),s.__views.detail.add(s.__views.__alloyId101),s.__views.imageLabel=Ti.UI.createLabel({color:"#808080",font:{fontSize:"14"},id:"imageLabel",text:"Lorem Ipsum is dummy text",left:"8",top:"0"}),s.__views.__alloyId101.add(s.__views.imageLabel),s.__views.hypen=Ti.UI.createLabel({color:"#808080",font:{fontSize:"14"},id:"hypen",text:" - ",top:"0"}),s.__views.__alloyId101.add(s.__views.hypen),s.__views.price=Ti.UI.createLabel({color:"#808080",font:{fontSize:"14"},id:"price",text:"$150.",top:"0"}),s.__views.__alloyId101.add(s.__views.price),s.__views.tags=Ti.UI.createScrollView({height:"20",layout:"horizontal",horizontalWrap:"false",contentWidth:"100%",contentHeight:"20",id:"tags"}),s.__views.detail.add(s.__views.tags),s.__views.__alloyId102=Ti.UI.createView({height:"18",width:Ti.UI.FILL,layout:"horizontal",id:"__alloyId102"}),s.__views.detail.add(s.__views.__alloyId102),s.__views.scoreLabel=Ti.UI.createLabel({color:"#4f4f4f",font:{fontSize:"14",fontWeight:"bold"},id:"scoreLabel",text:"Cool Score: ",left:"8"}),s.__views.__alloyId102.add(s.__views.scoreLabel),s.__views.score=Ti.UI.createLabel({color:"#1683af",font:{fontSize:"14",fontWeight:"bold"},id:"score",text:"35.6"}),s.__views.__alloyId102.add(s.__views.score),s.__views.statBegin=Ti.UI.createLabel({color:"#808080",font:{fontSize:"14"},id:"statBegin",text:" ("}),s.__views.__alloyId102.add(s.__views.statBegin),s.__views.win=Ti.UI.createLabel({color:"#808080",font:{fontSize:"14"},id:"win",text:"4"}),s.__views.__alloyId102.add(s.__views.win),s.__views.winText=Ti.UI.createLabel({color:"#808080",font:{fontSize:"14"},id:"winText",text:" wins / "}),s.__views.__alloyId102.add(s.__views.winText),s.__views.loss=Ti.UI.createLabel({color:"#808080",font:{fontSize:"14"},id:"loss",text:"0"}),s.__views.__alloyId102.add(s.__views.loss),s.__views.lossText=Ti.UI.createLabel({color:"#808080",font:{fontSize:"14"},id:"lossText",text:" losses)"}),s.__views.__alloyId102.add(s.__views.lossText),s.__views.commentScroller=Ti.UI.createTableView({id:"commentScroller",separatorColor:"#FFFFFF"}),s.__views.detail.add(s.__views.commentScroller),s.__views.__alloyId103=Ti.UI.createView({bottom:"0",height:"40",backgroundColor:"#E9E9E9",id:"__alloyId103"}),s.__views.detail.add(s.__views.__alloyId103),s.__views.commentField=Ti.UI.createTextField({color:"#808080",id:"commentField",clearButtonMode:Titanium.UI.INPUT_BUTTONMODE_ONFOCUS,autocorrect:"false",hintText:"comment",paddingLeft:"20",left:"10",height:"30",top:"5",bottom:"5",right:"90",borderRadius:"15",backgroundColor:"#FFF"}),s.__views.__alloyId103.add(s.__views.commentField),s.__views.postButton=Ti.UI.createButton({backgroundImage:"/images/btn_post.png",width:"60",height:"30",top:"5",bottom:"5",right:"10",id:"postButton"}),s.__views.__alloyId103.add(s.__views.postButton),a?s.__views.postButton.addEventListener("click",a):c["$.__views.postButton!click!postComment"]=!0,s.__views.__alloyId104=Ti.UI.createView({width:Ti.UI.FILL,height:40,bottom:0,backgroundColor:"#6dcff6",layout:"vertical",id:"__alloyId104"}),s.__views.tdv.add(s.__views.__alloyId104),s.__views.bottomBarButtons=Ti.UI.createView({width:Ti.UI.SIZE,id:"bottomBarButtons",layout:"horizontal"}),s.__views.__alloyId104.add(s.__views.bottomBarButtons),s.__views.__alloyId105=Ti.UI.createButton({top:"7",left:"20",width:"25",height:"25",backgroundImage:"/images/icon_fav.png",id:"__alloyId105"}),s.__views.bottomBarButtons.add(s.__views.__alloyId105),r?s.__views.__alloyId105.addEventListener("click",r):c["$.__views.__alloyId105!click!favThisThing"]=!0,s.__views.__alloyId106=Ti.UI.createButton({top:"7",left:"20",width:"31",height:"25",backgroundImage:"/images/icon_email.png",id:"__alloyId106"}),s.__views.bottomBarButtons.add(s.__views.__alloyId106),s.__views.__alloyId107=Ti.UI.createButton({top:"7",left:"20",width:"20",height:"25",backgroundImage:"/images/icon_flag.png",id:"__alloyId107"}),s.__views.bottomBarButtons.add(s.__views.__alloyId107),n?s.__views.__alloyId107.addEventListener("click",n):c["$.__views.__alloyId107!click!flagThisThing"]=!0,s.__views.cartButton=Ti.UI.createButton({top:"7",left:"20",width:"26",height:"25",id:"cartButton",backgroundImage:"/images/icon_cart.png"}),s.__views.bottomBarButtons.add(s.__views.cartButton),d.destroy=function(){},_.extend(s,s.__views);var u=Alloy.Globals.isiOS7Plus();s.tdv.top=u?20:0,Ti.UI.setBackgroundColor("#E9E9E9"),Ti.Gesture.addEventListener("orientationchange",o),o();var w=arguments[0]||{};if(w.thing){Ti.API.info("thing--"+JSON.stringify(w.thing));var v=new Date(w.thing.created_at);if(s.thingImage.image=w.thing.url,s.imageLabel.text=null==w.thing.description?"":w.thing.description,s.price.text=null==w.thing.buy_it?"":w.thing.buy_it,s.score.text=null==w.thing.cool_score?"":parseFloat(w.thing.cool_score).toFixed(2),s.win.text=null==w.thing.wins?"":w.thing.wins,s.loss.text=null==w.thing.losses?"":w.thing.losses,w.thing.tags.length>0)for(var g=0;w.thing.tags.length>g;g++){var h=Ti.UI.createLabel({left:"8",height:"18",top:"0",bottom:"0",width:Ti.UI.SIZE,color:"#FFF",backgroundColor:"#30D1F4",font:{fontWeight:"bold"},borderRadius:5,text:" "+w.thing.tags[g]+" "});s.tags.add(h)}var y="";y+=null==w.thing.user?"":"Posted by "+w.thing.user.name,y+=null==v?"":" on "+v.format("yyyy-MM-d"),y+=null==w.thing.original_url?"":" from "+Alloy.Globals.parseURL(w.thing.original_url),s.thingDetailsLabel.text=y,w.thing.buy_it||s.bottomBarButtons.remove(s.cartButton),l()}c["$.__views.tdv!close!onClose"]&&s.__views.tdv.addEventListener("close",i),c["$.__views.leftButton!click!goBack"]&&s.__views.leftButton.addEventListener("click",t),c["$.__views.thingImage!dblclick!showFullImage"]&&s.__views.thingImage.addEventListener("dblclick",e),c["$.__views.postButton!click!postComment"]&&s.__views.postButton.addEventListener("click",a),c["$.__views.__alloyId105!click!favThisThing"]&&s.__views.__alloyId105.addEventListener("click",r),c["$.__views.__alloyId107!click!flagThisThing"]&&s.__views.__alloyId107.addEventListener("click",n),_.extend(s,d)}var Alloy=require("alloy"),Backbone=Alloy.Backbone,_=Alloy._;module.exports=Controller;