function Controller(){function e(e){var t={};t.image=e.source.image;var i=Alloy.createController("imagefullview",t),o=i.getView();o.open({modal:!0,modalTransitionStyle:Ti.UI.iPhone.MODAL_TRANSITION_STYLE_FLIP_HORIZONTAL,modalStyle:Ti.UI.iPhone.MODAL_PRESENTATION_FULLSCREEN,navBarHidden:!0})}function t(e){if(e.source.thingId){var t={};t.popUpLabel="Confirm as inappropriate",t.but1Label="Confirm",t.but2label="Cancel",t.but1handler=function(){Alloy.Globals.loading.show("Flagging now, Please wait..",!0),Alloy.Globals.removeCurrentMatch();var t=Ti.Network.createHTTPClient();t.open("POST",Alloy.Globals.serverPath+"/api/things/"+e.source.thingId+"/flag"),t.send(),t.onload=function(){Alloy.Globals.loading.hide(),i.close(),Alloy.Globals.fetchNextMatch()},t.onerror=function(){Alloy.Globals.loading.hide(),i.close()}},t.but2handler=function(){i.close()};var i=Alloy.createController("popUpWindow",t).getView();i.open()}}function i(e){if(c){var t="thing"+e.source.id.replace(/^\D+/g,""),i={};c&&(i.thing=c[t]);var o=Alloy.createController("thingDetailView",i),l=o.getView();Alloy.Globals.navgroup.open(l)}}function o(e){if(c){n.score1.text=isNaN(parseFloat(c.thing1.cool_score))?"?":parseFloat(c.thing1.cool_score).toFixed(2),n.winslose1.text=isNaN(parseInt(c.thing1.wins))||isNaN(parseInt(c.thing1.losses))?"Not enough data yet":c.thing1.wins+" wins / "+c.thing1.losses+" losses",n.scoreCard1.visible=!0,n.score2.text=isNaN(parseFloat(c.thing2.cool_score))?"?":parseFloat(c.thing2.cool_score).toFixed(2),n.winslose2.text=isNaN(parseInt(c.thing2.wins))||isNaN(parseInt(c.thing2.losses))?"Not enough data yet":c.thing2.wins+" wins / "+c.thing2.losses+" losses",n.scoreCard2.visible=!0;var t={};t.losing_thing_id=e.source.loosingId,t.winning_thing_id=e.source.winningId,Ti.API.info(JSON.stringify(t)),Alloy.Globals.loading.show("Voting, Please wait..",!0);var i=Ti.Network.createHTTPClient();i.open("POST",Alloy.Globals.serverPath+"api/vote"),i.setRequestHeader("Content-Type","application/json"),i.onload=function(){Ti.Gesture.removeEventListener("orientationchange",a),setTimeout(function(){Alloy.Globals.fetchNextMatch()},Alloy.Globals.votingIdealTimer),Alloy.Globals.loading.hide()},i.onerror=function(e){Ti.API.info("error--"+JSON.stringify(e)),Alloy.Globals.loading.hide()},i.send(JSON.stringify(t))}}function l(){Alloy.Globals.loading.show("Loading, Please wait..",!0);var e=Ti.Network.createHTTPClient();e.open("GET",Alloy.Globals.serverPath+"/api/things/matchup"),e.send(),e.onload=function(){c=JSON.parse(this.responseText),n.img1.setImage(c.thing1.url),n.img1.winningId=c.thing1.id,n.img1.loosingId=c.thing2.id,n.flag1.thingId=c.thing1.id,n.img2.setImage(c.thing2.url),n.img2.winningId=c.thing2.id,n.img2.loosingId=c.thing1.id,n.flag2.thingId=c.thing2.id,n.scoreCard1.visible=!1,n.scoreCard2.visible=!1,Alloy.Globals.loading.hide()},e.onerror=function(){Ti.API.info("got some error"),Alloy.Globals.loading.hide()}}function a(){Ti.Gesture.orientation==Ti.UI.LANDSCAPE_LEFT||Ti.Gesture.orientation==Ti.UI.LANDSCAPE_RIGHT?(n.removeClass(n.info1,"info"),n.removeClass(n.info2,"info"),n.removeClass(n.flag1,"flag"),n.removeClass(n.flag2,"flag"),n.removeClass(n.portrait,"portrait"),n.addClass(n.thing1,"half"),n.addClass(n.thing2,"half"),n.addClass(n.info1,"linfo"),n.addClass(n.info2,"linfo"),n.addClass(n.flag1,"lflag"),n.addClass(n.flag2,"lflag")):(n.addClass(n.portrait,"landscape portrait"),n.removeClass(n.thing1,"half"),n.removeClass(n.thing2,"half"),n.removeClass(n.info1,"linfo"),n.removeClass(n.info2,"linfo"),n.removeClass(n.flag1,"lflag"),n.removeClass(n.flag2,"lflag"),n.addClass(n.info1,"info"),n.addClass(n.info2,"info"),n.addClass(n.flag1,"flag"),n.addClass(n.flag2,"flag"))}require("alloy/controllers/BaseController").apply(this,Array.prototype.slice.call(arguments)),this.__controllerPath="wicMatch",arguments[0]?arguments[0].__parentSymbol:null,arguments[0]?arguments[0].$model:null,arguments[0]?arguments[0].__itemTemplate:null;var n=this,r={},s={};n.__views.portrait=Ti.UI.createView({layout:"horizontal",width:Ti.UI.FILL,height:Ti.UI.FILL,apiName:"Ti.UI.View",id:"portrait",classes:["landscape","portrait"]}),n.__views.portrait&&n.addTopLevelView(n.__views.portrait),n.__views.thing1=Ti.UI.createView({height:"50%",width:"100%",apiName:"Ti.UI.View",id:"thing1",classes:["thing"]}),n.__views.portrait.add(n.__views.thing1),n.__views.img1=Ti.UI.createImageView({apiName:"Ti.UI.ImageView",id:"img1",top:"0",left:"0",bottom:"0",right:"0",classes:[]}),n.__views.thing1.add(n.__views.img1),e?n.__views.img1.addEventListener("doubletap",e):s["$.__views.img1!doubletap!showFullImage"]=!0,o?n.__views.img1.addEventListener("singletap",o):s["$.__views.img1!singletap!voteMe"]=!0;try{n.__views.img1.addEventListener("touchstart",Alloy.Globals.objectOpacityOnFocused)}catch(d){s["$.__views.img1!touchstart!Alloy.Globals.objectOpacityOnFocused"]=!0}try{n.__views.img1.addEventListener("touchend",Alloy.Globals.objectOpacityOnBlurred)}catch(d){s["$.__views.img1!touchend!Alloy.Globals.objectOpacityOnBlurred"]=!0}n.__views.flag1=Ti.UI.createButton({right:10,width:32,height:32,backgroundImage:"/images/flag.png",top:10,apiName:"Ti.UI.Button",id:"flag1",classes:["flagbasic","flag"]}),n.__views.thing1.add(n.__views.flag1),t?n.__views.flag1.addEventListener("click",t):s["$.__views.flag1!click!flagThisThing"]=!0,n.__views.info1=Ti.UI.createButton({bottom:10,width:32,height:32,backgroundImage:"/images/info.png",right:10,apiName:"Ti.UI.Button",id:"info1",classes:["infobasic","info"]}),n.__views.thing1.add(n.__views.info1),i?n.__views.info1.addEventListener("click",i):s["$.__views.info1!click!goToDetailThing"]=!0,n.__views.scoreCard1=Ti.UI.createView({top:0,left:0,bottom:0,right:0,visible:!1,backgroundColor:"#7000",backgroundImage:null,opacity:1,layout:"vertical",apiName:"Ti.UI.View",classes:["scoreCard"],id:"scoreCard1"}),n.__views.thing1.add(n.__views.scoreCard1),n.__views.score1=Ti.UI.createLabel({textAlign:"center",top:90,color:"#fff",font:{fontSize:30,fontWeight:"bold"},apiName:"Ti.UI.Label",id:"score1",classes:["thingScore"]}),n.__views.scoreCard1.add(n.__views.score1),n.__views.winslose1=Ti.UI.createLabel({textAlign:"center",color:"#fff",font:{fontSize:18},apiName:"Ti.UI.Label",id:"winslose1",classes:["thingWinsLose"]}),n.__views.scoreCard1.add(n.__views.winslose1),n.__views.thing2=Ti.UI.createView({height:"50%",width:"100%",apiName:"Ti.UI.View",id:"thing2",classes:["thing"]}),n.__views.portrait.add(n.__views.thing2),n.__views.img2=Ti.UI.createImageView({apiName:"Ti.UI.ImageView",id:"img2",top:"0",left:"0",bottom:"0",right:"0",classes:[]}),n.__views.thing2.add(n.__views.img2),e?n.__views.img2.addEventListener("doubletap",e):s["$.__views.img2!doubletap!showFullImage"]=!0,o?n.__views.img2.addEventListener("singletap",o):s["$.__views.img2!singletap!voteMe"]=!0;try{n.__views.img2.addEventListener("touchstart",Alloy.Globals.objectOpacityOnFocused)}catch(d){s["$.__views.img2!touchstart!Alloy.Globals.objectOpacityOnFocused"]=!0}try{n.__views.img2.addEventListener("touchend",Alloy.Globals.objectOpacityOnBlurred)}catch(d){s["$.__views.img2!touchend!Alloy.Globals.objectOpacityOnBlurred"]=!0}n.__views.flag2=Ti.UI.createButton({right:10,width:32,height:32,backgroundImage:"/images/flag.png",top:10,apiName:"Ti.UI.Button",id:"flag2",classes:["flagbasic","flag"]}),n.__views.thing2.add(n.__views.flag2),t?n.__views.flag2.addEventListener("click",t):s["$.__views.flag2!click!flagThisThing"]=!0,n.__views.info2=Ti.UI.createButton({bottom:10,width:32,height:32,backgroundImage:"/images/info.png",right:10,apiName:"Ti.UI.Button",id:"info2",classes:["infobasic","info"]}),n.__views.thing2.add(n.__views.info2),i?n.__views.info2.addEventListener("click",i):s["$.__views.info2!click!goToDetailThing"]=!0,n.__views.scoreCard2=Ti.UI.createView({top:0,left:0,bottom:0,right:0,visible:!1,backgroundColor:"#7000",backgroundImage:null,opacity:1,layout:"vertical",apiName:"Ti.UI.View",classes:["scoreCard"],id:"scoreCard2"}),n.__views.thing2.add(n.__views.scoreCard2),n.__views.score2=Ti.UI.createLabel({textAlign:"center",top:90,color:"#fff",font:{fontSize:30,fontWeight:"bold"},apiName:"Ti.UI.Label",id:"score2",classes:["thingScore"]}),n.__views.scoreCard2.add(n.__views.score2),n.__views.winslose2=Ti.UI.createLabel({textAlign:"center",color:"#fff",font:{fontSize:18},apiName:"Ti.UI.Label",id:"winslose2",classes:["thingWinsLose"]}),n.__views.scoreCard2.add(n.__views.winslose2),r.destroy=function(){},_.extend(n,n.__views);var c;l(),Ti.Gesture.addEventListener("orientationchange",a),a(),s["$.__views.img1!doubletap!showFullImage"]&&n.__views.img1.addEventListener("doubletap",e),s["$.__views.img1!singletap!voteMe"]&&n.__views.img1.addEventListener("singletap",o),s["$.__views.img1!touchstart!Alloy.Globals.objectOpacityOnFocused"]&&n.__views.img1.addEventListener("touchstart",Alloy.Globals.objectOpacityOnFocused),s["$.__views.img1!touchend!Alloy.Globals.objectOpacityOnBlurred"]&&n.__views.img1.addEventListener("touchend",Alloy.Globals.objectOpacityOnBlurred),s["$.__views.flag1!click!flagThisThing"]&&n.__views.flag1.addEventListener("click",t),s["$.__views.info1!click!goToDetailThing"]&&n.__views.info1.addEventListener("click",i),s["$.__views.img2!doubletap!showFullImage"]&&n.__views.img2.addEventListener("doubletap",e),s["$.__views.img2!singletap!voteMe"]&&n.__views.img2.addEventListener("singletap",o),s["$.__views.img2!touchstart!Alloy.Globals.objectOpacityOnFocused"]&&n.__views.img2.addEventListener("touchstart",Alloy.Globals.objectOpacityOnFocused),s["$.__views.img2!touchend!Alloy.Globals.objectOpacityOnBlurred"]&&n.__views.img2.addEventListener("touchend",Alloy.Globals.objectOpacityOnBlurred),s["$.__views.flag2!click!flagThisThing"]&&n.__views.flag2.addEventListener("click",t),s["$.__views.info2!click!goToDetailThing"]&&n.__views.info2.addEventListener("click",i),_.extend(n,r)}var Alloy=require("alloy"),Backbone=Alloy.Backbone,_=Alloy._;module.exports=Controller;